"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="clustered.map"),function(e,t,n){"use strict";t.module("clustered.map",[]).factory("google",["$window",function(e){if(e.google===n||e.MarkerClusterer===n)throw new Error("google is not bound to window");return{maps:e.google.maps,MarkerClusterer:e.MarkerClusterer}}]).factory("utils",function(){return{getCenter:function(e){var t={x:0,y:0},n=0;return e.map(function(e){t.x+=e[0]*e[2],t.y+=e[1]*e[2],n+=e[2]}),t.x/=n,t.y/=n,t},getCalculator:function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r].weight;return{text:n,index:Math.min(String(n).length,t)}}}}).directive("clusteredMap",["google","utils",function(e,n){return{restrict:"EA",replace:!0,template:'<div id="map_canvas"></div>',scope:{markers:"=",zoom:"=",center:"="},link:function(r,o){function a(a){var i=r.center||{x:0,y:0};r.center||(i=n.getCenter(a));var u=new e.maps.LatLng(Math.floor(i.x),Math.floor(i.y)),l=t.element(o[0])[0],c=new e.maps.Map(l,{zoom:r.zoom||2,center:u,mapTypeId:e.maps.MapTypeId.ROADMAP});a=a.map(function(t){if(t=new e.maps.Marker({position:new e.maps.LatLng(t[0],t[1]),weight:t[2],title:"weight:"+t[2],content:t.length>3?t[3]:null,icon:5===t.length?t[4]:null}),t.content){var n=new e.maps.InfoWindow({content:t.content});e.maps.event.addListener(t,"click",function(){n.open(c,t)})}return t});var s=new e.MarkerClusterer(c);s.setCalculator(n.getCalculator),s.addMarkers(a)}r.$watch(function(){return r.markers},function(){r.markers&&a(r.markers)})}}}])}(window,window.angular);